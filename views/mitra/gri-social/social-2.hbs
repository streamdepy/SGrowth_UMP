<main class="flex flex-col items-start self-center ml-48 mt-16 w-full max-w-[1168px] max-md:mt-10 max-md:max-w-full">
  <header class="flex gap-3.5 self-start">
    <img
      src="https://api.builder.io/api/v1/image/assets/TEMP/07073f8526333ac3749a4d99615ea0579a831ebe?placeholderIfAbsent=true&apiKey=ac04cd396e1f47f18955cd19640f183d"
      alt="GRI Social icon"
      class="object-contain shrink-0 my-auto rounded-full aspect-[1.04] w-[58px]"
    />
    <div class="flex flex-col">
      <h2 class="text-4xl font-semibold text-black">GRI Social</h2>
      <p class="self-center text-xl font-medium leading-none text-center text-gray-500">
        Social Performance
      </p>
    </div>
  </header>

  <!-- 401-1: Employee Turnover -->
  <section class="self-stretch pt-12 pb-20 pl-16 mb-16 mt-10 bg-white rounded-2xl shadow-2xl max-md:pl-5 max-md:max-w-full">
    <h3 class="text-3xl font-semibold text-teal-700">
      401-1 • Employee Turnover
    </h3>
    <p class="mt-3 text-gray-500">
      Please enter the total number and turnover rate of employees during the reporting period, categorized by <span class="font-medium">age group</span>, <span class="font-medium">gender</span>, and <span class="font-medium">region</span>.
    </p>

    <!-- Meta period (optional, if already provided can be removed) -->
    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 pr-8 md:pr-12 lg:pr-16">
      <div>
        <label class="block pb-2 text-base font-medium">Reporting Period</label>
        <input type="text" name="reporting_period" placeholder="e.g. 2025-Q3"
          class="w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition">
      </div>
      <div>
        <label class="block pb-2 text-base font-medium">Region (optional)</label>
        <select name="region_level"
          class="w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition">
          <option value="">Select</option>
          <option value="city">City/Province</option>
          <option value="state">State/Province</option>
          <option value="country">Country</option>
          <option value="site">Site/Plant</option>
        </select>
      </div>
    </div>

    <!-- Employee turnover entries -->
    <div id="turnover_list" class="space-y-8 mt-8 pr-8 md:pr-12 lg:pr-16">
      <!-- Entry #0 (initial) -->
      <div class="turnover-item border border-gray-200 rounded-2xl p-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
          <!-- Age Group -->
          <div>
            <label class="block pb-2 text-base font-medium">Age Group</label>
            <select class="to-age w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition">
              <option value="">Select</option>
              <option value="<30">&lt; 30</option>
              <option value="30-50">30–50</option>
              <option value=">50">&gt; 50</option>
              <option value="other">Other</option>
            </select>
            <input type="text" class="to-age-other w-full px-4 py-3 mt-3 border rounded-lg bg-slate-50 hidden" placeholder="Specify other age group">
          </div>

          <!-- Gender -->
          <div>
            <label class="block pb-2 text-base font-medium">Gender</label>
            <select class="to-gender w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition">
              <option value="">Select</option>
              <option value="Female">Female</option>
              <option value="Male">Male</option>
              <option value="Not specified">Not specified</option>
              <option value="other">Other</option>
            </select>
            <input type="text" class="to-gender-other w-full px-4 py-3 mt-3 border rounded-lg bg-slate-50 hidden" placeholder="Specify other gender">
          </div>

          <!-- Region -->
          <div>
            <label class="block pb-2 text-base font-medium">Region</label>
            <input type="text" class="to-region w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition" placeholder="e.g. Jakarta, Jatim, Kalbar">
          </div>
        </div>

        <!-- Turnover figures & total segments -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mt-6">
          <div>
            <label class="block pb-2 text-base font-medium">Number of Employee Turnovers</label>
            <input type="number" min="0" value="0"
              class="to-left w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition">
          </div>
          <div>
            <label class="block pb-2 text-base font-medium">Total Employees in Segment</label>
            <input type="number" min="0" value="0"
              class="to-headcount w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition" placeholder="Average/End of Period">
          </div>
          <div>
            <label class="block pb-2 text-base font-medium">Turnover Rate (%)</label>
            <div class="relative">
              <input type="text" readonly class="to-rate w-full px-8 py-4 pr-16 text-base rounded-2xl border border-gray-200 bg-gray-50" placeholder="0.00">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">%</span>
            </div>
          </div>
        </div>

        <!-- Notes (optional) & Delete -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-[1fr_auto] gap-4">
          <input type="text" class="to-notes w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50"
                 placeholder="Notes (optional)">
          <button type="button"
                  class="turnover-remove hidden px-4 py-2 border rounded-xl text-gray-700 hover:bg-gray-50">
            Delete Entry
          </button>
        </div>
      </div>
    </div>

    <!-- Add Entry Button -->
    <div class="mt-6 flex justify-end pr-8 md:pr-12 lg:pr-16">
      <button type="button" id="turnover_add_item"
              class="inline-flex items-center gap-2 px-4 py-2 rounded-xl text-teal-700 text-sm font-medium transition hover:bg-teal-50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
        </svg>
        Add Entry
      </button>
    </div>

    <!-- Total Summary -->
    <div class="mt-10 pr-8 md:pr-12 lg:pr-16">
      <h4 class="text-2xl font-semibold text-teal-700">Total Summary (Automatic)</h4>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mt-4">
        <div>
          <div class="text-gray-500">Total Employee Turnovers</div>
          <div class="text-3xl text-teal-700 font-semibold" id="sum_turnover">0</div>
        </div>
        <div>
          <div class="text-gray-500">Total Employees in All Segments</div>
          <div class="text-3xl text-teal-700 font-semibold" id="sum_turnover_headcount">0</div>
        </div>
        <div>
          <div class="text-gray-500">Overall Turnover Rate</div>
          <div class="text-3xl text-teal-700 font-semibold">
            <span id="sum_turnover_rate">0.00</span><span class="text-xl">%</span>
          </div>
        </div>
      </div>
      <p class="mt-3 text-sm text-gray-500">
        Turnover rate formula: <span class="font-medium">(Employee Turnovers ÷ Total Employees in Segment) × 100%</span>
      </p>
    </div>

    <!-- Navigation -->
    <div class="flex justify-end gap-4 mt-10 w-full pr-8 md:pr-12 lg:pr-16">
      <button type="button" onclick="window.history.back()"
        class="px-8 py-2 text-base font-medium text-center text-teal-700 border-teal-700 border border-solid whitespace-nowrap bg-white rounded-xl hover:bg-teal-700 hover:text-white transition-colors">
        Previous
      </button>
      <a href="/mitra/social-3"
        class="px-8 py-2 text-base font-medium text-center text-white whitespace-nowrap bg-lime-500 rounded-xl hover:bg-lime-600 transition-colors">
        Next
      </a>
    </div>
  </section>
</main>

<!-- Template for Employee Turnover Entry -->
<template id="turnover_item_tpl">
  <div class="turnover-item border border-gray-200 rounded-2xl p-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
      <div>
        <label class="block pb-2 text-base font-medium">Age Group</label>
        <select class="to-age w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition">
          <option value="">Select</option>
          <option value="<30">&lt; 30</option>
          <option value="30-50">30–50</option>
          <option value=">50">&gt; 50</option>
          <option value="other">Other</option>
        </select>
        <input type="text" class="to-age-other w-full px-4 py-3 mt-3 border rounded-lg bg-slate-50 hidden" placeholder="Specify other age group">
      </div>
      <div>
        <label class="block pb-2 text-base font-medium">Gender</label>
        <select class="to-gender w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition">
          <option value="">Select</option>
          <option value="Female">Female</option>
          <option value="Male">Male</option>
          <option value="Not specified">Not specified</option>
          <option value="other">Other</option>
        </select>
        <input type="text" class="to-gender-other w-full px-4 py-3 mt-3 border rounded-lg bg-slate-50 hidden" placeholder="Specify other gender">
      </div>
      <div>
        <label class="block pb-2 text-base font-medium">Region</label>
        <input type="text" class="to-region w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition" placeholder="e.g. Jakarta, Jatim, Kalbar">
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mt-6">
      <div>
        <label class="block pb-2 text-base font-medium">Number of Employee Turnovers</label>
        <input type="number" min="0" value="0"
          class="to-left w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition">
      </div>
      <div>
        <label class="block pb-2 text-base font-medium">Total Employees in Segment</label>
        <input type="number" min="0" value="0"
          class="to-headcount w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50 outline-none hover:ring focus:ring-2 focus:ring-teal-600 transition" placeholder="Average/End of Period">
      </div>
      <div>
        <label class="block pb-2 text-base font-medium">Turnover Rate (%)</label>
        <div class="relative">
          <input type="text" readonly class="to-rate w-full px-8 py-4 pr-16 text-base rounded-2xl border border-gray-200 bg-gray-50" placeholder="0.00">
          <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">%</span>
        </div>
      </div>
    </div>

    <div class="mt-6 grid grid-cols-1 md:grid-cols-[1fr_auto] gap-4">
      <input type="text" class="to-notes w-full px-8 py-4 text-base rounded-2xl border border-gray-300 bg-slate-50"
             placeholder="Notes (optional)">
      <button type="button" class="turnover-remove px-4 py-2 border rounded-xl text-gray-700 hover:bg-gray-50">
        Delete Entry
      </button>
    </div>
  </div>
</template>

<script>
  // util
  function toggleEl(el, show){ if(!el) return; el.classList.toggle('hidden', !show); }

  document.addEventListener('DOMContentLoaded', function(){
    const list   = document.getElementById('turnover_list');
    const addBtn = document.getElementById('turnover_add_item');
    const tpl    = document.getElementById('turnover_item_tpl');

    // Hitung rate per item & ringkasan total
    function recomputeAll(){
      let sumTurnover = 0, sumHead = 0;

      list.querySelectorAll('.turnover-item').forEach(item => {
        const turnover = parseFloat(item.querySelector('.to-left')?.value || '0');
        const head  = parseFloat(item.querySelector('.to-headcount')?.value || '0');
        const rate  = head > 0 ? (turnover / head) * 100 : 0;
        const rateEl = item.querySelector('.to-rate');
        if (rateEl) rateEl.value = rate.toFixed(2);
        sumTurnover += isNaN(turnover)?0:turnover;
        sumHead  += isNaN(head)?0:head;
      });

      const sumRate = sumHead > 0 ? (sumTurnover / sumHead) * 100 : 0;
      document.getElementById('sum_turnover').textContent = sumTurnover.toString();
      document.getElementById('sum_turnover_headcount').textContent = sumHead.toString();
      document.getElementById('sum_turnover_rate').textContent = sumRate.toFixed(2);
    }

    function attachHandlers(item){
      // tampilkan input "lainnya"
      const ageSel = item.querySelector('.to-age');
      const ageOther = item.querySelector('.to-age-other');
      const genSel = item.querySelector('.to-gender');
      const genOther = item.querySelector('.to-gender-other');

      function syncOther(sel, other){
        const isOther = sel && sel.value === 'lainnya';
        toggleEl(other, isOther);
        if (!isOther && other) other.value = '';
      }
      if (ageSel){ ageSel.addEventListener('change', () => syncOther(ageSel, ageOther)); syncOther(ageSel, ageOther); }
      if (genSel){ genSel.addEventListener('change', () => syncOther(genSel, genOther)); syncOther(genSel, genOther); }

      // perhitungan otomatis
      ['.to-left','.to-headcount'].forEach(cls=>{
        const el = item.querySelector(cls);
        if (el) el.addEventListener('input', recomputeAll);
      });

      // hapus entri
      const rm = item.querySelector('.turnover-remove');
      if (rm){
        rm.addEventListener('click', () => {
          if (list.querySelectorAll('.turnover-item').length > 1){
            item.remove();
            recomputeAll();
          }
        });
      }
    }

    // item awal
    const first = list.querySelector('.turnover-item');
    if (first) attachHandlers(first);
    recomputeAll();

    // tambah item
    if (addBtn){
      addBtn.addEventListener('click', ()=>{
        const clone = tpl.content.firstElementChild.cloneNode(true);
        list.appendChild(clone);
        attachHandlers(clone);
        // pastikan tombol hapus terlihat untuk item tambahan
        const rm = clone.querySelector('.turnover-remove');
        if (rm) rm.classList.remove('hidden');
        recomputeAll();
      });
    }
  });
</script>
